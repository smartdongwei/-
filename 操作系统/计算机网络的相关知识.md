# 计算机网络的相关知识

## 1 TCP三次握手和四次挥手

###     1.1 TCP三次握手的含义

​    为了准确把数据送达到目标处，TCP协议采用了三次握手策略。最主要的目的是双方确认自己与对方的发送和接收是正常的。

简单示意图如下：

- 客户端–发送带有SYN 标志的数据包 – 一次握手 – 服务端
- 服务端–发送带有SYN/ACK 标志的数据包 – 二次握手 – 客户端
- 客户端–发送带有带有ACK 标志的数据包 – 三次握手 – 服务端

第一次握手：Client什么都不能确认，Server确认了对方发送正常，自己接收正常。

第二次握手：Client确认了：自己发送、接收正常，对方发送、接收正常；Server确认了：对方发送正常，自己接收正常。

第三次握手：Client确认了：自己发送、接收正常，对方发送、接收正常；Server确认了：自己发送、接收正常，对方发送、接收正常。

### 1.2 为什么要传回SYN

​    接收端传回所发送的SYN是为了告诉发送端，我接受到的信息就是你发送的信号。

> **SYN是TCP/IP 建时连接时使用的握手信号。在客户机和服务器之间建立正常的TCP 网络连接时，客户机首先发出一个SYN 消息，服务器使用SYN-ACK 应答表示接收到了这个消息，最后客户机再以ACK(Acknowledgement[汉译：确认字符,在数据通信传输中，接收站发给发送站的一种传输控制字符。它表示确认发来的数据已经接受无误。]）消息响应。这样在客户机和服务器之间才能建立起可靠的TCP连接，数据才可以在客户机和服务器之间传递。**

### 1.3 传了SYN，为啥要穿ACK

   双方通道无误必须是两者互相发送信息都无误，传了SYN，证明发送发到接收方的通道没有问题，但是接收方到发送方的通道还需要ACK信号来进行验证。



### 1.4 TCP的四次挥手

​    **断开一个TCP 连接则需要“四次挥手”：**

- 客户端-发送一个FIN，用来关闭客户端到服务器的数据传送
- 服务器-收到这个FIN，它发回一个ACK，确认序号为收到的序号加1 。和SYN 一样，一个FIN 将占用一个序号
- 服务器-关闭与客户端的连接，发送一个FIN给客户端
- 客户端-发回ACK 报文确认，并将确认序号设置为收到序号加1

​    任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送的时候，则发出连接释放通知，对方确认后就完全关闭了TCP连接。

​    举个例子：A 和B 打电话，通话即将结束后，A 说“我没啥要说的了”，B回答“我知道了”，但是B可能还会有要说的话，A 不能要求B 跟着自己的节奏结束通话，于是B 可能又巴拉巴拉说了一通，最后B 说“我说完了”，A 回答“知道了”，这样通话才算结束。



## 2 TCP、UDP协议的区别

​    UDP在传送数据之前不需要先建立连接，主机在收到UDP报文之后，不需要给出任何确认。虽然UDP不提供可靠交付，但是在某些情况下UDP是一种最有效的工作方式。

​    TCP提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后释放连接。TCP不提供广播或多播服务。由于TCP要提供可靠的，面向连接的传输服务(会先进行三次握手来建立连接，在数据传递时，有确认等内容)，这使得协议数据单元的首部增大很多，还要占用许多处理机资源。TCP一般用于文件传输、发送和接收邮件、远程登录等场景。

### 2.1 TCP 协议如何保证可靠传输

1. 应用数据被分割成TCP 认为最适合发送的数据块。
2. TCP 给发送的每⼀个包进⾏编号，接收⽅对数据包进⾏排序，把有序数据传送给应⽤层。
3. 校验和：TCP 将保持它⾸部和数据的检验和。这是⼀个端到端的检验和，⽬的是检测数据
  在传输过程中的任何变化。如果收到段的检验和有差错，TCP 将丢弃这个报⽂段和不确认收
  到此报⽂段。
4. TCP 的接收端会丢弃重复的数据。
5. 流量控制：TCP 连接的每⼀⽅都有固定⼤⼩的缓冲空间，TCP的接收端只允许发送端发送
  接收端缓冲区能接纳的数据。当接收⽅来不及处理发送⽅的数据，能提示发送⽅降低发送的
  速率，防⽌包丢失。TCP 使⽤的流量控制协议是可变⼤⼩的滑动窗⼝协议。 （TCP 利⽤滑
  动窗⼝实现流量控制）
6. 拥塞控制： 当⽹络拥塞时，减少数据的发送。
7. ARQ协议： 也是为了实现可靠传输的，它的基本原理就是每发完⼀个分组就停⽌发送，等
  待对⽅确认。在收到确认后再发下⼀个分组。
8. 超时重传： 当TCP 发出⼀个段后，它启动⼀个定时器，等待⽬的端确认收到这个报⽂段。
  如果不能及时收到⼀个确认，将重发这个报⽂段。 

















